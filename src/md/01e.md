---
title: Exercise 1!
subtitle: Stuff is broken!
objectives:
  - 'Loading in Sveltekit.'
  - 'Hooks.'
  - 'Error handling.'
published: true
prev: '01b'
next: '02'
---

## Let's create a page and load some data!

Feel free to reference the Svelte [examples](https://svelte.dev/examples/hello-world) as needed!

I dare you to try this first part without navigating to the page. Also you won't be able to. But still.

Navigate to `./src/routes/(everything_else)/exercise/f1` and create a page.

We want to pull in some data with a _server-side load_. The data we're looking for is in `./src/routes/(everything_else)/exercise/f1/data.ts` (or you can search for FINDTHEDATA :)) and we want to pull in all of the exported fields (drivers, races, results, teams) and return those on the load object.

Here's the [Svelte documentation](https://kit.svelte.dev/docs/load) for loading for reference - if you search for `+page.server.js` you'll find what you need, albeit with JSDoc and _not_ in Typescript.

Once we've gotten the data loaded, let's just drop it into a div to make sure it's working:

```html
<div>{JSON.stringify(theData)}</div>
<div>{JSON.stringify(thatData)}</div>
...
```

### And now let's try navigate to the [page](/exercise/f1).

At this point you have probably tried to navigate to the page in your browser to see if your load function worked...and discovered that you can't access it! Not only that, you've probably also discovered that our error handling is kind of lame.

### Let's fix the error handling first!

Recall that we can handle errors via a `+error.svelte` page. Let's create one now...here is some basic HTML to get you started, but you have to template the data yourself:

```svelte
<script>
	import { page } from '$app/stores';
	import { onMount } from 'svelte';
	import { fade } from 'svelte/transition';

	// If I don't do this, error updates to null and then throws before the next page is ready
	// this also breaks nav back
	// we'll cover the $ shenanigans later
	const code = $page.status;
	const message = $page.error?.message;

	let ready = false;

	// we'll cover lifecycles in a later lesson, for now just let the copy/pasta flow through you
	onMount(() => {
		ready = true;
	});
</script>

{#if ready}
	<div class="error-wrapper" transition:fade={{ duration: 500 }}>
		<section class="content-wrapper">
			<h1>Whoops!</h1>
			<!-- template me with the error and message! -->
			<h3>what | happened</h3>

			<!-- let's make our gifs 100% more giphy! -->
			<!-- we can use a if/else block for this!  -->
			<!-- if the error is < 500, we should show no.gif -->
			<img src="/assets/no.gif" alt="You can't do that" />
			<!-- otherwise, we should show crash.gif -->
			<img src="/assets/crash.gif" alt="Server error" />
		</section>
	</div>
{/if}

<style>
	.error-wrapper {
		height: 100vh;
		text-align: center;
		padding-top: 5vh;
	}

	.content-wrapper {
		margin: auto;
		width: 50%;
		align-items: center;
		height: 80%;
	}
</style>
```

### And now let's try navigate to the [page](/exercise/f1) again.

That looks better...but we still can't proceed.

This is an example of how protected routes (authorization) can (and should) be implemented in Svelte. Let's navigate to the `hooks.server.ts` file in the src root (`src/hooks.server.ts`).

We should fix the auth here using `locals` which are found in `src/app.d.ts`. Let's uncomment this line:

```typescript
// interface Locals {}
```

and add a field to track whether or not the user has access. We could do this differently, but we'll need to track it with `locals` later on anyway.

Now that `locals` is updated, let's go back to `hooks.server.ts` and pull it in via the `event` along with the resolve function. Note that these params are destructured, so it should look like this now:

```typescript
export const handle: Handle = async ({ event, resolve }) => {
```

Once we're pulling in `event`, we can access locals in `hooks` as `event.locals` and any fields or functions on `locals` as `event.locals.<name>`.

Let's update the statements, and now one last time we can try to [see if our data loading worked](/exercise/f1).

If it all works then you are the best developer actually alive. If it didn't then you are still the best developer alive, and I wrote terrible instructions.

### Let's go to the next lesson!
